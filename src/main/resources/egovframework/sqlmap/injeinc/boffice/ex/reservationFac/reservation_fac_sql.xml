<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReservationFacDao">
	<resultMap id="ReservationFacMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationIndexVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="riTitle" column="RI_TITLE"/>
		<result property="riSupervisionOrg" column="RI_SUPERVISION_ORG"/>
		<result property="riSupervisionOrgName" column="RI_SUPERVISION_ORG_NAME"/>
		<result property="riManageDept" column="RI_MANAGE_DEPT"/>
		<result property="riManageDeptTxt" column="RI_MANAGE_DEPT_TXT"/>
		<result property="riLotUse" column="RI_LOT_USE"/>
		<result property="riConfirmYn" column="RI_CONFIRM_YN"/>
		<result property="riProgress" column="RI_PROGRESS"/>
		<result property="riSdate" column="RI_SDATE"/>
		<result property="riEdate" column="RI_EDATE"/>
		<result property="riReservationSdate" column="RI_RESERVATION_SDATE"/>
		<result property="riReservationEdate" column="RI_RESERVATION_EDATE"/>
		<result property="riImageFileId" column="RI_IMAGE_FILE_ID"/>
		<result property="riReadCnt" column="RI_READ_CNT"/>
		<result property="riPlace" column="RI_PLACE"/>
		<result property="riRecruitYn" column="RI_RECRUIT_YN"/>
		<result property="riRecruitCnt" column="RI_RECRUIT_CNT"/>
		<result property="riReservationstd" column="RI_RESERVATION_SDT"/>
		<result property="riReservationetd" column="RI_RESERVATION_EDT"/>		
		<result property="riMainFileNm" column="RI_MAIN_FILE_NM"/>
		<result property="riOffLotUse" column="RI_OFF_LOT_USE"/>
		<result property="riPoYn" column="RI_PO_YN"/>
	</resultMap>
	
	<resultMap id="ReservationFacAnotherMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationIndexVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="riTitle" column="RI_TITLE"/>				
		<result property="riProgress" column="RI_PROGRESS"/>		
	</resultMap>

	<resultMap id="ReservationFacViewMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationIndexVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="riType" column="RI_TYPE"/>
		<result property="riTitle" column="RI_TITLE"/>
		<result property="riSupervisionOrg" column="RI_SUPERVISION_ORG"/>
		<result property="riSupervisionOrgName" column="RI_SUPERVISION_ORG_NAME"/>
		<result property="riManageDept" column="RI_MANAGE_DEPT"/>
		<result property="riManageDeptTxt" column="RI_MANAGE_DEPT_TXT"/>
		<result property="riProgress" column="RI_PROGRESS"/>
		<result property="riTel1" column="RI_TEL1"/>
		<result property="riTel2" column="RI_TEL2"/>
		<result property="riTel3" column="RI_TEL3"/>
		<result property="riPlace" column="RI_PLACE"/>
		<result property="riPay" column="RI_PAY"/>
		<result property="riGuide" column="RI_GUIDE"/>
		<result property="riDayWeek" column="RI_DAY_WEEK"/>
		<result property="riLotUse" column="RI_LOT_USE"/>
		<result property="riOffLotUse" column="RI_OFF_LOT_USE"/>
		<result property="riSdate" column="RI_SDATE"/>
		<result property="riEdate" column="RI_EDATE"/>
		<result property="riSiteUrl" column="RI_SITE_URL"/>
		<result property="riUserloginType" column="RI_USERLOGIN_TYPE"/>
		<result property="riRecruitCnt" column="RI_RECRUIT_CNT"/>
		<result property="riRecruitMaxCnt" column="RI_RECRUIT_MAX_CNT"/>
		<result property="riReservationSdate" column="RI_RESERVATION_SDATE"/>
		<result property="riReservationSdateHh" column="RI_RESERVATION_SDATE_HH"/>
		<result property="riReservationSdateMm" column="RI_RESERVATION_SDATE_MM"/>
		<result property="riReservationEdate" column="RI_RESERVATION_EDATE"/>
		<result property="riReservationEdateHh" column="RI_RESERVATION_EDATE_HH"/>
		<result property="riReservationEdateMm" column="RI_RESERVATION_EDATE_MM"/>
		<result property="riConfirmSdate" column="RI_CONFIRM_SDATE"/>
		<result property="riConfirmSdateHh" column="RI_CONFIRM_SDATE_HH"/>
		<result property="riConfirmSdateMm" column="RI_CONFIRM_SDATE_MM"/>
		<result property="riConfirmEdate" column="RI_CONFIRM_EDATE"/>
		<result property="riConfirmEdateHh" column="RI_CONFIRM_EDATE_HH"/>
		<result property="riConfirmEdateMm" column="RI_CONFIRM_EDATE_MM"/>
		<result property="riAfterRegsterYn" column="RI_AFTER_REGSTER_YN"/>
		<result property="riConfirmYn" column="RI_CONFIRM_YN"/>
		<result property="riHaveFac" column="RI_HAVE_FAC"/>
		<result property="riImageFileId" column="RI_IMAGE_FILE_ID"/>
		<result property="regId" column="REG_ID"/>
		<result property="regDt" column="REG_DT"/>
		<result property="riAccCnt" column="RI_ACC_CNT"/>
		<result property="ruLotResult" column="RU_LOT_RESULT"/>
		<result property="ruIdx" column="RU_IDX"/>
		<result property="useYn" column="USE_YN"/>		
		<result property="riRservationminTime" column="RI_RESERVATION_MIN_TIME"/>
		<result property="riRservationmaxTime" column="RI_RESERVATION_MAX_TIME"/>
		<result property="riPoYn" column="RI_PO_YN"/>
		<result property="riFeeGubun" column="RI_FEE_GUBUN"/>
		<result property="riMainFileNm" column="RI_MAIN_FILE_NM"/>
		<result property="riOnlinePayYn" column="RI_ONLINE_PAY_YN"/>
		<result property="riPayYn" column="RI_PAY_YN"/>
		<result property="payStatus" column="PAY_STATUS"/>
		<result property="pgKey" column="PGKEY"/>
	</resultMap>
	
	<resultMap id="ReservationFacViewMap2" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationIndexVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="riType" column="RI_TYPE"/>
		<result property="riTitle" column="RI_TITLE"/>
		<result property="riSupervisionOrg" column="RI_SUPERVISION_ORG"/>
		<result property="riSupervisionOrgName" column="RI_SUPERVISION_ORG_NAME"/>
		<result property="riManageDept" column="RI_MANAGE_DEPT"/>
		<result property="riManageDeptTxt" column="RI_MANAGE_DEPT_TXT"/>
		<result property="riProgress" column="RI_PROGRESS"/>
		<result property="riTel1" column="RI_TEL1"/>
		<result property="riTel2" column="RI_TEL2"/>
		<result property="riTel3" column="RI_TEL3"/>
		<result property="riPlace" column="RI_PLACE"/>
		<result property="riPay" column="RI_PAY"/>
		<result property="riGuide" column="RI_GUIDE"/>
		<result property="riDayWeek" column="RI_DAY_WEEK"/>
		<result property="riLotUse" column="RI_LOT_USE"/>
		<result property="riOffLotUse" column="RI_OFF_LOT_USE"/>
		<result property="riSdate" column="RI_SDATE"/>
		<result property="riEdate" column="RI_EDATE"/>
		<result property="riSiteUrl" column="RI_SITE_URL"/>
		<result property="riUserloginType" column="RI_USERLOGIN_TYPE"/>
		<result property="riRecruitCnt" column="RI_RECRUIT_CNT"/>
		<result property="riRecruitMaxCnt" column="RI_RECRUIT_MAX_CNT"/>
		<result property="riReservationSdate" column="RI_RESERVATION_SDATE"/>
		<result property="riReservationSdateHh" column="RI_RESERVATION_SDATE_HH"/>
		<result property="riReservationSdateMm" column="RI_RESERVATION_SDATE_MM"/>
		<result property="riReservationEdate" column="RI_RESERVATION_EDATE"/>
		<result property="riReservationEdateHh" column="RI_RESERVATION_EDATE_HH"/>
		<result property="riReservationEdateMm" column="RI_RESERVATION_EDATE_MM"/>
		<result property="riConfirmSdate" column="RI_CONFIRM_SDATE"/>
		<result property="riConfirmSdateHh" column="RI_CONFIRM_SDATE_HH"/>
		<result property="riConfirmSdateMm" column="RI_CONFIRM_SDATE_MM"/>
		<result property="riConfirmEdate" column="RI_CONFIRM_EDATE"/>
		<result property="riConfirmEdateHh" column="RI_CONFIRM_EDATE_HH"/>
		<result property="riConfirmEdateMm" column="RI_CONFIRM_EDATE_MM"/>
		<result property="riAfterRegsterYn" column="RI_AFTER_REGSTER_YN"/>
		<result property="riConfirmYn" column="RI_CONFIRM_YN"/>
		<result property="riHaveFac" column="RI_HAVE_FAC"/>
		<result property="riImageFileId" column="RI_IMAGE_FILE_ID"/>
		<result property="regId" column="REG_ID"/>
		<result property="regDt" column="REG_DT"/>
		<result property="riAccCnt" column="RI_ACC_CNT"/>
		<result property="riMainFileNm" column="RI_MAIN_FILE_NM"/>
		<result property="riOnlinePayYn" column="RI_ONLINE_PAY_YN"/>
		<result property="riPayYn" column="RI_PAY_YN"/>
		<result property="riFeeGubun" column="RI_FEE_GUBUN"/>		
		<result property="pgKey" column="PGKEY"/>
	</resultMap>

	<resultMap id="ReservationFacAddItemMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationAddItemVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="raIdx" column="RA_IDX"/>
		<result property="raTitle" column="RA_TITLE"/>
		<result property="raContent" column="RA_CONTENT"/>
	</resultMap>

	<resultMap id="ReservationFacItemMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationItemVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="rtIdx" column="RT_IDX"/>
		<result property="rtItemType" column="RT_ITEM_TYPE"/>
		<result property="rtItemTitle" column="RT_ITEM_TITLE"/>
		<result property="rtItemExample" column="RT_ITEM_EXAMPLE"/>
		<result property="rtItemExampleLen" column="RT_ITEM_EXAMPLE_LEN"/>
		<result property="rtItemNotice" column="RT_ITEM_NOTICE"/>
		<result property="rtItemUseCheck" column="RT_ITEM_USE_CHECK"/>
		<result property="rtItemEtcUseCheck" column="RT_ITEM_ETC_USE_CHECK"/>
		<result property="rtAnswer" column="RT_ANSWER"/>
		<result property="rtEtcAnswer" column="RT_ETC_ANSWER"/>
	</resultMap>

	<resultMap id="ReservationFacUserInfoMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationUserInfoVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="ruIdx" column="RU_IDX"/>
		<result property="ruName" column="RU_NAME"/>
		<result property="ruDupkey" column="RU_DUPKEY"/>
		<result property="ruZipcode" column="RU_ZIPCODE"/>
		<result property="ruAddress" column="RU_ADDRESS"/>
		<result property="ruAddressDtl" column="RU_ADDRESS_DTL"/>
		<result property="ruTel" column="RU_TEL"/>
		<result property="ruHp" column="RU_HP"/>
		<result property="ruEmail" column="RU_EMAIL"/>
		<result property="ruLotResult" column="RU_LOT_RESULT"/>
		<result property="ruUserloginType" column="RU_USERLOGIN_TYPE"/>
		<result property="ruIp" column="RU_IP"/>
		<result property="ruReservationName" column="RU_RESERVATION_NAME"/>
		<result property="raIdx" column="RA_IDX"/>
		<result property="ruReservationDay" column="RU_RESERVATION_DAY"/>
		<result property="rtmIdx" column="RTM_IDX"/>
		<result property="payStatus" column="PAY_STATUS"/>
		<result property="payPrice" column="PAY_PRICE"/>
		<result property="ordno" column="ORDNO"/>
		<result property="payTid" column="PAY_TID"/>
		<result property="payAuth" column="PAY_AUTH"/>
		<result property="payMemo" column="PAY_MEMO"/>
		<result property="method" column="METHOD"/>
	</resultMap>
	
	<resultMap id="ReservationMyFacMap" type="egovframework.injeinc.boffice.ex.reservation.vo.ReservationIndexVo">
		<result property="riIdx" column="RI_IDX"/>
		<result property="ruIdx" column="RU_IDX"/>
		<result property="riTitle" column="RI_TITLE"/>
		<result property="riManageDeptTxt" column="RI_MANAGE_DEPT_TXT"/>
		<result property="ruReservationDay" column="RU_RESERVATION_DAY"/>
		<result property="ruReservationTime" column="RA_CONTENT"/>
		<result property="riProgress" column="RI_PROGRESS"/>
		<result property="ruLotResult" column="RU_LOT_RESULT"/>
	</resultMap>
	
	<resultMap id="ReservationFacCalMap" type="ReservationFacTimeVo">
		<result property="year" column="YEAR"/>
		<result property="month" column="MONTH"/>
		<result property="day" column="DAY"/>
		<result property="cellNum" column="CELL_NUM"/>
		<result property="weeks" column="WEEKS"/>
		<result property="week" column="WEEK"/>
		<result property="restAt" column="REST_AT"/>
		<result property="riReservationYn" column="RI_RESERVATION_YN"/>
		<result property="riReservationYn2" column="RI_RESERVATION_YN2"/>
		<result property="riReservationCnt" column="RI_RESERVATION_CNT"/>		
		<collection property="timelist" resultMap="ReservationFacCalMap_SUB"/>				
	</resultMap>
	
	<resultMap id="ReservationFacCalMap_SUB" type="ReservationFacTimeVo">	
		<result property="riIdx" column="RI_IDX"/>
		<result property="rtmIdx" column="RTM_IDX"/>	
		<result property="rtmWeek" column="RTM_WEEK"/>
		<result property="stTime" column="ST_TIME"/>
		<result property="etTime" column="ED_TIME"/>
		<result property="rtmType" column="RTM_TYPE"/>
		<result property="rtmTerm" column="RTM_TERM"/>		
		<result property="tTypeCnt" column="TTYPECNT"/>
		<result property="ruReservationDay" column="RU_RESERVATION_DAY"/>
		<result property="ruLotResult" column="RU_LOT_RESULT"/>
	</resultMap>
	
	<resultMap id="ReservationFacTimeMap" type="ReservationFacTimeVo">	
		<result property="rtmWeek" column="RTM_WEEK"/>		
		<result property="rtmType" column="RTM_TYPE"/>		
		<result property="rtmTerm" column="RTM_TERM"/>		
		<collection property="tlist" resultMap="ReservationFacTimeVo_Sub"/>	
	</resultMap>
	
	<resultMap id="ReservationFacTimeVo_Sub" type="ReservationFacTimeVo">			
		<result property="stTime" column="ST_TIME"/>
		<result property="etTime" column="ED_TIME"/>					
	</resultMap>
	
	<resultMap id="ReservationFacUserTimeMap" type="ReservationFacTimeVo">	
		<result property="rtmWeek" column="RTM_WEEK"/>		
		<result property="rtmType" column="RTM_TYPE"/>		
		<result property="rtmTerm" column="RTM_TERM"/>						
		<result property="stTime" column="ST_TIME"/>
		<result property="etTime" column="ED_TIME"/>
		<result property="rtmIdx" column="RTM_IDX"/>					
	</resultMap>
	
	<resultMap id="ReservationFacUserTimeMap2" type="ReservationFacTimeVo">	
		<result property="rtmWeek" column="RTM_WEEK"/>		
		<result property="rtmType" column="RTM_TYPE"/>		
		<result property="rtmTerm" column="RTM_TERM"/>						
		<result property="stTime" column="ST_TIME"/>
		<result property="etTime" column="ED_TIME"/>
		<result property="rtmIdx" column="RTM_IDX"/>
		<result property="ruReservationDay" column="RU_RESERVATION_DAY"/>					
	</resultMap>

	<insert id="insertReservationFac" parameterType="ReservationIndexVo">
		<![CDATA[	
			INSERT INTO EZ_RESERVATION_INDEX
			(
			    RI_IDX
                , RI_TYPE
	            , RI_TITLE
	            , RI_SUPERVISION_ORG
	            , RI_SUPERVISION_ORG_NAME
	            , RI_MANAGE_DEPT
	            , RI_TEL1
	            , RI_TEL2
	            , RI_TEL3
	            , RI_PLACE	            
	            , RI_PAY
	            , RI_GUIDE
	            , RI_LOT_USE
	            , RI_OFF_LOT_USE
	            , RI_SDATE
	            , RI_EDATE
	            , RI_HAVE_FAC
	            , RI_SITE_URL
	            , RI_USERLOGIN_TYPE
	            , RI_RECRUIT_CNT
	            , RI_RECRUIT_MAX_CNT
	            , RI_RESERVATION_SDATE
	            , RI_RESERVATION_SDATE_HH
	            , RI_RESERVATION_SDATE_MM
	            , RI_RESERVATION_EDATE
	            , RI_RESERVATION_EDATE_HH
	            , RI_RESERVATION_EDATE_MM
	            , RI_CONFIRM_SDATE
	            , RI_CONFIRM_SDATE_HH
	            , RI_CONFIRM_SDATE_MM
	            , RI_CONFIRM_EDATE
	            , RI_CONFIRM_EDATE_HH
	            , RI_CONFIRM_EDATE_MM
	            , RI_AFTER_REGSTER_YN
	            , RI_CONFIRM_YN
	            , RI_DAY_WEEK
	            , RI_IMAGE_FILE_ID
	            , REG_ID
	            , REG_DT
	            , USE_YN
	            , RI_RESERVATION_MIN_TIME
	            , RI_RESERVATION_MAX_TIME
	            , RI_PO_YN
	            , RI_FEE_GUBUN	       
	            , RI_ONLINE_PAY_YN    
	            , RI_PAY_YN
	            , PGKEY
			)
			VALUES
			(
				#{riIdx}
				,#{riType}
	            ,#{riTitle}
	            ,#{riSupervisionOrg}
	            ,#{riSupervisionOrgName}
	            ,#{riManageDept}
	            ,#{riTel1}
	            ,#{riTel2}
	            ,#{riTel3}
	            ,#{riPlace}
	            ,#{riPay}
	            ,#{riGuide}
	            ,#{riLotUse}
	            ,#{riOffLotUse}
	            ,#{riSdate}
	            ,#{riEdate}
	            ,#{riHaveFac}
	            ,#{riSiteUrl}
	            ,#{riUserloginType}
	            ,#{riRecruitCnt}
	            ,#{riRecruitMaxCnt}
	            ,#{riReservationSdate}
	            ,#{riReservationSdateHh}
	            ,#{riReservationSdateMm}
	            ,#{riReservationEdate}
	            ,#{riReservationEdateHh}
	            ,#{riReservationEdateMm}
	            ,#{riConfirmSdate}
	            ,#{riConfirmSdateHh}
	            ,#{riConfirmSdateMm}
	            ,#{riConfirmEdate}
	            ,#{riConfirmEdateHh}
	            ,#{riConfirmEdateMm}
	            ,#{riAfterRegsterYn}
	            ,#{riConfirmYn}
	            ,#{riDayWeek}
	            ,#{riImageFileId}
	            ,#{regId}
	            ,sysdate
	            ,'Y'
	            ,#{riRservationminTime}
	            ,#{riRservationmaxTime}
	            ,#{riPoYn}
	            ,#{riFeeGubun}	 
	            ,#{riOnlinePayYn}
	            ,#{riPayYn}
	            ,#{pgKey}          
			)
		]]>
	</insert>

	<insert id="insertReservationFacAddItem" parameterType="ReservationAddItemVo">
		<![CDATA[	
			INSERT INTO RESERVATION_ADD_ITEM
			(
			    RI_IDX
	            , RA_IDX
	            , RA_TITLE
	            , RA_CONTENT
	            , REG_ID
	            , REG_DT
			)
			VALUES
			(
				#{riIdx}
				,#{raIdx}
				,#{raTitle}
				,#{raContent}
				,#{regId}
				,sysdate
			)
		]]>
	</insert>
	
	<insert id="insertReservationFacTime" parameterType="ReservationFacTimeVo">
		<![CDATA[	
			INSERT INTO RESERVATION_TIME
			(
			    RI_IDX
	            , RTM_IDX
	            , RTM_WEEK
	            , ST_TIME
	            , ED_TIME
	            , RTM_TYPE
	            , RTM_TERM
	            , REG_DT
			)
			VALUES
			(
				#{riIdx}
				,#{rtmIdx}
				,#{rtmWeek}
				,#{stTime}
				,#{etTime}
				,#{rtmType}
				,#{rtmTerm}
				,sysdate
				
			)
		]]>
	</insert>

	<update id="updateReservationFac" parameterType="ReservationIndexVo">
		<![CDATA[	
			UPDATE EZ_RESERVATION_INDEX
			SET
			   RI_TITLE = #{riTitle},
		       RI_SUPERVISION_ORG = #{riSupervisionOrg},
		       RI_SUPERVISION_ORG_NAME = #{riSupervisionOrgName},
		       RI_MANAGE_DEPT = #{riManageDept},
		       RI_TEL1 = #{riTel1},
		       RI_TEL2 = #{riTel2},
		       RI_TEL3 = #{riTel3},
		       RI_PLACE = #{riPlace},
		       RI_PAY = #{riPay},
		       RI_GUIDE = #{riGuide},
		       RI_LOT_USE = #{riLotUse},
		       RI_OFF_LOT_USE = #{riOffLotUse},
		       RI_DAY_WEEK = #{riDayWeek},
		       RI_SDATE = #{riSdate},
		       RI_EDATE = #{riEdate},
		       RI_SITE_URL = #{riSiteUrl},
		       RI_USERLOGIN_TYPE = #{riUserloginType},
		       RI_RECRUIT_CNT = #{riRecruitCnt},
		       RI_RECRUIT_MAX_CNT = #{riRecruitMaxCnt},
		       RI_RESERVATION_SDATE = #{riReservationSdate},
		       RI_RESERVATION_SDATE_HH = #{riReservationSdateHh},
		       RI_RESERVATION_SDATE_MM = #{riReservationSdateMm},
		       RI_RESERVATION_EDATE = #{riReservationEdate},
		       RI_RESERVATION_EDATE_HH = #{riReservationEdateHh},
		       RI_RESERVATION_EDATE_MM = #{riReservationEdateMm},
		       RI_CONFIRM_SDATE = #{riConfirmSdate},
		       RI_CONFIRM_SDATE_HH = #{riConfirmSdateHh},
		       RI_CONFIRM_SDATE_MM = #{riConfirmSdateMm},
		       RI_CONFIRM_EDATE = #{riConfirmEdate},
		       RI_CONFIRM_EDATE_HH = #{riConfirmEdateHh},
		       RI_CONFIRM_EDATE_MM = #{riConfirmEdateMm},
		       RI_AFTER_REGSTER_YN = #{riAfterRegsterYn},
		       RI_CONFIRM_YN = #{riConfirmYn},
		       RI_HAVE_FAC = #{riHaveFac},
		       RI_IMAGE_FILE_ID = #{riImageFileId},
			   MOD_DT = SYSDATE,
			   MOD_ID = #{modId},
			   RI_RESERVATION_MIN_TIME = #{riRservationminTime},
			   RI_RESERVATION_MAX_TIME = #{riRservationmaxTime},
			   RI_PO_YN = #{riPoYn},
			   RI_FEE_GUBUN = #{riFeeGubun},
			   RI_ONLINE_PAY_YN = #{riOnlinePayYn},
			   RI_PAY_YN = #{riPayYn},
			   PGKEY = #{pgKey}	
			WHERE RI_IDX = #{riIdx}
		]]>
	</update>

	<update id="deleteReservationFac" parameterType="ReservationIndexVo">
		<![CDATA[	
			UPDATE EZ_RESERVATION_INDEX
			SET
				USE_YN = 'N'
				, MOD_DT = SYSDATE
				, MOD_ID = #{modId}
			WHERE RI_IDX = #{riIdx}
		]]>
	</update>

	<select id="selectReservationFac" parameterType="ReservationIndexVo" resultMap="ReservationFacViewMap">
		<![CDATA[	
			SELECT
				ri.RI_IDX,
		        ri.RI_TYPE,
		        ri.RI_TITLE,
		        ri.RI_SUPERVISION_ORG,
		        ri.RI_SUPERVISION_ORG_NAME,
		        ri.RI_MANAGE_DEPT,
		        (SELECT CD_SUBJECT FROM EZ_DEPARTMENT WHERE CD_IDX = ri.RI_MANAGE_DEPT) RI_MANAGE_DEPT_TXT,
		        CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
		          ELSE '예약완료' END RI_PROGRESS,
		        ri.RI_TEL1,
		        ri.RI_TEL2,
		        ri.RI_TEL3,
		        ri.RI_PLACE,
		        ri.RI_PAY,
		        ri.RI_GUIDE,
		        ri.RI_DAY_WEEK,
		        ri.RI_LOT_USE,
		        ri.RI_OFF_LOT_USE,
		        ri.RI_SDATE,
		        ri.RI_EDATE,
		        ri.RI_SITE_URL,
		        ri.RI_USERLOGIN_TYPE,
		        ri.RI_RECRUIT_CNT,
		        ri.RI_RECRUIT_MAX_CNT,
		        ri.RI_RESERVATION_SDATE,
		        ri.RI_RESERVATION_SDATE_HH,
		        ri.RI_RESERVATION_SDATE_MM,
		        ri.RI_RESERVATION_EDATE,
		        ri.RI_RESERVATION_EDATE_HH,
		        ri.RI_RESERVATION_EDATE_MM,
		        ri.RI_CONFIRM_SDATE,
		        ri.RI_CONFIRM_SDATE_HH,
		        ri.RI_CONFIRM_SDATE_MM,
		        ri.RI_CONFIRM_EDATE,
		        ri.RI_CONFIRM_EDATE_HH,
		        ri.RI_CONFIRM_EDATE_MM,
		        ri.RI_AFTER_REGSTER_YN,
		        ri.RI_CONFIRM_YN,
		        ri.RI_HAVE_FAC,
		        ri.RI_IMAGE_FILE_ID,
		        ri.REG_ID,
		        ri.REG_DT,
		        (SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = ri.RI_IDX AND RU_DEL_YN = 'N')	RI_ACC_CNT,
		        ru.RU_LOT_RESULT,
                ru.RU_IDX,
                ru.RU_DEL_YN USE_YN,
                ri.RI_RESERVATION_MIN_TIME,
                ri.RI_RESERVATION_MAX_TIME,
                ri.RI_PO_YN,
                ri.RI_FEE_GUBUN,
                (select STRE_FILE_NM from COMTNFILEDETAIL where ATCH_FILE_ID = ri.RI_IMAGE_FILE_ID) as RI_MAIN_FILE_NM,
                ri.RI_PAY_YN,
                ri.RI_ONLINE_PAY_YN,
                ru.PAY_STATUS,
                ri.PGKEY
			FROM EZ_RESERVATION_INDEX ri
			LEFT OUTER JOIN RESERVATION_USER_INFO ru ON ri.RI_IDX = ru.RI_IDX AND ru.RU_DUPKEY = #{ruDupkey}
			WHERE ri.USE_YN = 'Y'
			AND ri.RI_IDX = #{riIdx}
		]]>
	</select>
	
	<!-- 추첨방법체크 -->
	<select id="selectReservationFacLotUse" parameterType="ReservationIndexVo" resultType="String">
		<![CDATA[	
			SELECT RI_LOT_USE FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx}
		]]>
	</select>
	
	<!-- 항목추가 수 -->
	<select id="selectReservationFacAddCnt" parameterType="ReservationIndexVo" resultType="String">
		<![CDATA[	
			SELECT COUNT(*) AS ADDCNT FROM RESERVATION_ADD_ITEM WHERE RI_IDX = #{riIdx}
		]]>
	</select>

	<select id="selectListReservationFacCal" parameterType="ReservationFacVo" resultType="egovMap">
		<![CDATA[	
		SELECT  #{year}               YEAR
	                 ,  #{month}              MONTH
	                 ,  DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                                         DAY
	                 ,  T_DUMMY.RNUM           CELL_NUM
	                 ,  T_DUMMY.WEEKS + 1      WEEKS
	                 ,  T_DUMMY.WEEK           WEEK
	                 ,  CASE T_DUMMY.WEEK WHEN 1 THEN 'Y' WHEN 7 THEN 'Y' ELSE 'N' END AS REST_AT
	                 ,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN RI_SDATE AND RI_EDATE
	                    ) AS RI_RESERVATION_YN

	              FROM  (
	                    SELECT  (W.W*7) + D.D RNUM
	                         ,  W.W WEEKS
	                         ,  D.D WEEK
	                      FROM  (
							    SELECT 0 W  FROM DUAL
							    UNION ALL
							    SELECT 1 FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    ) W,
							    (
							    SELECT 1 D FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    UNION ALL
							    SELECT 6 FROM DUAL
							    UNION ALL
							    SELECT 7 FROM DUAL
	                            ) D
	                    ORDER BY (W.W*7) + D.D
	            ) T_DUMMY
				ORDER BY T_DUMMY.RNUM
		]]>
	</select>
	
	<select id="selectListReservationFacCal2" parameterType="ReservationFacVo" resultType="egovMap">
		<![CDATA[	
		SELECT  #{year}               YEAR
	                 ,  #{month}              MONTH
	                 ,  DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                                         DAY
	                 ,  T_DUMMY.RNUM           CELL_NUM
	                 ,  T_DUMMY.WEEKS + 1      WEEKS
	                 ,  T_DUMMY.WEEK           WEEK
	                 ,  CASE T_DUMMY.WEEK WHEN 1 THEN 'Y' WHEN 7 THEN 'Y' ELSE 'N' END AS REST_AT
	                 ,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN RI_SDATE AND RI_EDATE
	                    ) AS RI_RESERVATION_YN
	                  ,  (
                        SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = #{riIdx} 
                                   AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) = RU_RESERVATION_DAY
                       ) AS RI_RESERVATION_CNT
	              FROM  (
	                    SELECT  (W.W*7) + D.D RNUM
	                         ,  W.W WEEKS
	                         ,  D.D WEEK
	                      FROM  (
							    SELECT 0 W  FROM DUAL
							    UNION ALL
							    SELECT 1 FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    ) W,
							    (
							    SELECT 1 D FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    UNION ALL
							    SELECT 6 FROM DUAL
							    UNION ALL
							    SELECT 7 FROM DUAL
	                            ) D
	                    ORDER BY (W.W*7) + D.D
	            ) T_DUMMY
				ORDER BY T_DUMMY.RNUM
		]]>
	</select>
	
	<select id="selectListReservationFacCal3" parameterType="ReservationFacVo" resultMap="ReservationFacCalMap">
		<![CDATA[	
		SELECT YEAR,MONTH,DAY,CELL_NUM,WEEKS,WEEK,REST_AT,RI_RESERVATION_YN,RI_RESERVATION_YN2,RI_RESERVATION_CNT,d.RI_IDX,d.RTM_IDX,d.RTM_WEEK,ST_TIME,ED_TIME,RTM_TYPE,RTM_TERM,TTYPECNT,e.ru_reservation_day,RU_LOT_RESULT
			FROM(
			SELECT  #{year}               YEAR
			     ,  #{month}              MONTH
			     ,  DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                                         DAY
			     ,LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) RESERVATION_DAY
			                             
			     ,  T_DUMMY.RNUM           CELL_NUM
			     ,  T_DUMMY.WEEKS + 1      WEEKS
			     ,  T_DUMMY.WEEK           WEEK
			     ,  CASE T_DUMMY.WEEK WHEN 1 THEN 'Y' WHEN 7 THEN 'Y' ELSE 'N' END AS REST_AT
			    
				,  (
                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
                               AND LPAD(#{year},4,'0')||'-'
                                      ||LPAD(#{month},2,'0')||'-'
                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
                    			             ,2,'0'
                    			            ) BETWEEN RI_SDATE AND RI_EDATE
                    ) AS RI_RESERVATION_YN	
                 ,  (
                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
                               AND LPAD(#{year},4,'0')||'-'
                                      ||LPAD(#{month},2,'0')||'-'
                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
                    			             ,2,'0'
                    			            ) BETWEEN RI_SDATE AND RI_EDATE
                    ) AS RI_RESERVATION_YN2			
                  ,  (
                       SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = #{riIdx} 
                                  AND LPAD(#{year},4,'0')||'-'
                                      ||LPAD(#{month},2,'0')||'-'
                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
                    			             ,2,'0'
                    			            ) = RU_RESERVATION_DAY
                      ) AS RI_RESERVATION_CNT,RI_IDX,RTM_IDX,RTM_WEEK,ST_TIME,ED_TIME,RTM_TYPE,RTM_TERM,CEIL((ED_TIME-ST_TIME)/RTM_TERM) AS TTYPECNT
			  FROM  (
			        SELECT  (W.W*7) + D.D RNUM
			             ,  W.W WEEKS
			             ,  D.D WEEK
			          FROM  (
			                SELECT 0 W  FROM DUAL
			                UNION ALL
			                SELECT 1 FROM DUAL
			                UNION ALL
			                SELECT 2 FROM DUAL
			                UNION ALL
			                SELECT 3 FROM DUAL
			                UNION ALL
			                SELECT 4 FROM DUAL
			                UNION ALL
			                SELECT 5 FROM DUAL
			                ) W,
			                (
			                SELECT 1 D FROM DUAL
			                UNION ALL
			                SELECT 2 FROM DUAL
			                UNION ALL
			                SELECT 3 FROM DUAL
			                UNION ALL
			                SELECT 4 FROM DUAL
			                UNION ALL
			                SELECT 5 FROM DUAL
			                UNION ALL
			                SELECT 6 FROM DUAL
			                UNION ALL
			                SELECT 7 FROM DUAL
			                ) D
			        ORDER BY (W.W*7) + D.D
			) T_DUMMY,RESERVATION_TIME A
			    WHERE T_DUMMY.WEEK = A.RTM_WEEK(+)
			    AND A.RI_IDX(+) = #{riIdx}
			    ORDER BY T_DUMMY.RNUM,ST_TIME
			) D,(select rtm_idx,rtm_week,ru_reservation_day,RU_LOT_RESULT from reservation_user_info where ri_idx = #{riIdx} and ru_del_yn = 'N' ) E
			where 
			INSTR( e.rtm_idx(+), d.rtm_idx) > 0
			and d.reservation_day = e.ru_reservation_day(+)				
		]]>
	</select>
	
	<select id="selectListReservationFacCal4" parameterType="ReservationFacVo" resultMap="ReservationFacCalMap">
		<![CDATA[	
		SELECT YEAR,MONTH,DAY,CELL_NUM,WEEKS,WEEK,REST_AT,RI_RESERVATION_YN,RI_RESERVATION_YN2,RI_RESERVATION_CNT,d.RI_IDX,d.RTM_IDX,d.RTM_WEEK,ST_TIME,ED_TIME,RTM_TYPE,RTM_TERM,TTYPECNT,e.ru_reservation_day,RU_LOT_RESULT
			FROM(
			SELECT  #{year}               YEAR
			     ,  #{month}              MONTH
			     ,  DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                                         DAY
			     ,LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) RESERVATION_DAY
			                             
			     ,  T_DUMMY.RNUM           CELL_NUM
			     ,  T_DUMMY.WEEKS + 1      WEEKS
			     ,  T_DUMMY.WEEK           WEEK
			     ,  CASE T_DUMMY.WEEK WHEN 1 THEN 'Y' WHEN 7 THEN 'Y' ELSE 'N' END AS REST_AT
		]]>	     
	             	 <if test="riAfterRegsterYn == &quot;Y&quot;">
		<![CDATA[					
					 ,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN RI_SDATE AND RI_EDATE
	                    ) AS RI_RESERVATION_YN
		]]>				
					 </if>
					 <if test="riAfterRegsterYn == &quot;N&quot;">
		<![CDATA[					
					,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN TO_CHAR(SYSDATE + RI_CONFIRM_EDATE,'YYYY-MM-DD') AND TO_CHAR(SYSDATE + RI_CONFIRM_SDATE,'YYYY-MM-DD')
	                    ) AS RI_RESERVATION_YN							
		]]>				
					 </if>			     
        <![CDATA[	             
                   ,  (
                   SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
                              AND LPAD(#{year},4,'0')||'-'
                                     ||LPAD(#{month},2,'0')||'-'
                                     ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
                   			             ,2,'0'
                   			            ) BETWEEN RI_SDATE AND RI_EDATE
                   ) AS RI_RESERVATION_YN2
                  ,  (
                       SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = #{riIdx} 
                                  AND LPAD(#{year},4,'0')||'-'
                                      ||LPAD(#{month},2,'0')||'-'
                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
                    			             ,2,'0'
                    			            ) = RU_RESERVATION_DAY
                      ) AS RI_RESERVATION_CNT,RI_IDX,RTM_IDX,RTM_WEEK,ST_TIME,ED_TIME,RTM_TYPE,RTM_TERM,CEIL((ED_TIME-ST_TIME)/RTM_TERM) AS TTYPECNT
			  FROM  (
			        SELECT  (W.W*7) + D.D RNUM
			             ,  W.W WEEKS
			             ,  D.D WEEK
			          FROM  (
			                SELECT 0 W  FROM DUAL
			                UNION ALL
			                SELECT 1 FROM DUAL
			                UNION ALL
			                SELECT 2 FROM DUAL
			                UNION ALL
			                SELECT 3 FROM DUAL
			                UNION ALL
			                SELECT 4 FROM DUAL
			                UNION ALL
			                SELECT 5 FROM DUAL
			                ) W,
			                (
			                SELECT 1 D FROM DUAL
			                UNION ALL
			                SELECT 2 FROM DUAL
			                UNION ALL
			                SELECT 3 FROM DUAL
			                UNION ALL
			                SELECT 4 FROM DUAL
			                UNION ALL
			                SELECT 5 FROM DUAL
			                UNION ALL
			                SELECT 6 FROM DUAL
			                UNION ALL
			                SELECT 7 FROM DUAL
			                ) D
			        ORDER BY (W.W*7) + D.D
			) T_DUMMY,RESERVATION_TIME A
			    WHERE T_DUMMY.WEEK = A.RTM_WEEK(+)
			    AND A.RI_IDX(+) = #{riIdx}
			    ORDER BY T_DUMMY.RNUM,ST_TIME
			) D,(select rtm_idx,rtm_week,ru_reservation_day,RU_LOT_RESULT from reservation_user_info where ri_idx = #{riIdx} and ru_del_yn = 'N' ) E
			where 
			INSTR( e.rtm_idx(+), d.rtm_idx) > 0
			and d.reservation_day = e.ru_reservation_day(+)				
		]]>
	</select>
	
	
	
	<select id="selectListReservationFacCalUser" parameterType="ReservationFacVo" resultType="egovMap">
	<![CDATA[		
		SELECT  #{year}               YEAR
	                 ,  #{month}              MONTH
	                 ,  DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                                         DAY
	                 ,  T_DUMMY.RNUM           CELL_NUM
	                 ,  T_DUMMY.WEEKS + 1      WEEKS
	                 ,  T_DUMMY.WEEK           WEEK
	                 ,  CASE T_DUMMY.WEEK WHEN 1 THEN 'Y' WHEN 7 THEN 'Y' ELSE 'N' END AS REST_AT
	 ]]>              
	             	 <if test="riAfterRegsterYn == &quot;Y&quot;">
	<![CDATA[						
					 ,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN RI_SDATE AND RI_EDATE
	                    ) AS RI_RESERVATION_YN
	]]>					
					 </if>
					 <if test="riAfterRegsterYn == &quot;N&quot;">
	<![CDATA[						
					,  (
	                    SELECT 'Y' FROM EZ_RESERVATION_INDEX WHERE RI_IDX = #{riIdx} AND INSTR(RI_DAY_WEEK, T_DUMMY.WEEK) > 0
	                               AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) BETWEEN TO_CHAR(SYSDATE + RI_CONFIRM_EDATE,'YYYY-MM-DD') AND TO_CHAR(SYSDATE + RI_CONFIRM_SDATE,'YYYY-MM-DD')
	                   ) AS RI_RESERVATION_YN							
	 ]]>					
					 </if>	    
	<![CDATA[				              
	                  ,  (
                        SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = #{riIdx} 
                                   AND LPAD(#{year},4,'0')||'-'
	                                      ||LPAD(#{month},2,'0')||'-'
	                                      ||LPAD(DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},0),0,'',DECODE(GREATEST(T_DUMMY.RNUM + 1 - #{startWeekMonth},#{lastDayMonth}),#{lastDayMonth},TO_CHAR(T_DUMMY.RNUM + 1 - #{startWeekMonth}),''))
	                    			             ,2,'0'
	                    			            ) = RU_RESERVATION_DAY
                       ) AS RI_RESERVATION_CNT
	              FROM  (
	                    SELECT  (W.W*7) + D.D RNUM
	                         ,  W.W WEEKS
	                         ,  D.D WEEK
	                      FROM  (
							    SELECT 0 W  FROM DUAL
							    UNION ALL
							    SELECT 1 FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    ) W,
							    (
							    SELECT 1 D FROM DUAL
							    UNION ALL
							    SELECT 2 FROM DUAL
							    UNION ALL
							    SELECT 3 FROM DUAL
							    UNION ALL
							    SELECT 4 FROM DUAL
							    UNION ALL
							    SELECT 5 FROM DUAL
							    UNION ALL
							    SELECT 6 FROM DUAL
							    UNION ALL
							    SELECT 7 FROM DUAL
	                            ) D
	                    ORDER BY (W.W*7) + D.D
	            ) T_DUMMY
				ORDER BY T_DUMMY.RNUM
		]]>
	</select>



	<sql id="searchReservationFac">
		<if test="riConfirmYn != null and riConfirmYn != ''">
			<![CDATA[ AND RI_CONFIRM_YN = #{riConfirmYn} ]]>
		</if>
		<if test="searchKeywordFrom != null and searchKeywordFrom != ''">
			 <![CDATA[ AND #{searchKeywordFrom} BETWEEN RI_SDATE AND RI_EDATE ]]>
		</if>
		<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == &quot;title&quot;">AND
				<![CDATA[ 
					RI_TITLE LIKE '%'||#{searchKeyword}||'%'
				]]>
			</if>
			<if test="searchCondition == &quot;org&quot;">AND
				<![CDATA[ 
					RI_SUPERVISION_ORG = #{searchKeyword}
				]]>
			</if>
			<if test="searchCondition == &quot;all&quot;">AND
				<![CDATA[ 
					(RI_TITLE LIKE '%'||#{searchKeyword}||'%' OR RI_SUPERVISION_ORG = #{searchKeyword})
				]]>
			</if>
		</if>
		<if test="riManageDept != null and riManageDept != ''">
			<![CDATA[ 
				AND RI_MANAGE_DEPT = #{riManageDept}
			]]>
		</if>
		<if test="riReservationSdate != null and riReservationSdate != ''">
			<if test="riReservationEdate != null and riReservationEdate != ''">
				<![CDATA[ 
					AND (#{riReservationSdate} between RI_RESERVATION_SDATE AND RI_RESERVATION_EDATE OR #{riReservationEdate} between RI_RESERVATION_SDATE AND RI_RESERVATION_EDATE)
				]]>
			</if>
			<if test="riReservationEdate == null or riReservationEdate == ''">
				<![CDATA[ 
					AND #{riReservationSdate} between RI_RESERVATION_SDATE AND RI_RESERVATION_EDATE
				]]>
			</if>
		</if>
		<if test="riReservationSdate == null or riReservationSdate == ''">
			<if test="riReservationEdate != null and riReservationEdate != ''">
				<![CDATA[ 
					AND #{riReservationEdate} between RI_RESERVATION_SDATE AND RI_RESERVATION_EDATE
				]]>
			</if>
		</if>
		<if test="strList != null and strList.size!=0">
		<![CDATA[ 
			AND (RI_DAY_WEEK LIKE
		]]>
			<foreach collection="strList" item="item" separator="OR RI_DAY_WEEK LIKE" close=")">
	            <![CDATA[  '%'||#{item}||'%' ]]>
		    </foreach>
	    </if>
	    <if test="mgrSiteCdList != null and mgrSiteCdList!=0">
			<![CDATA[ AND RI_SUPERVISION_ORG IN (]]>
				 <foreach collection="mgrSiteCdList" item="item" separator=",">
					<![CDATA[  #{item} ]]>
				</foreach>
			)
		</if>
	</sql>

	<select id="selectPagReservationFac" parameterType="ReservationIndexVo" resultMap="ReservationFacMap">
		<![CDATA[ 
			SELECT * FROM (
				SELECT /*+ FIRST_ROWS */ A.*, ROWNUM RN FROM (
					SELECT
						RI_IDX,
				        RI_TITLE,
				        RI_SUPERVISION_ORG,
				        RI_SUPERVISION_ORG_NAME,
				        RI_MANAGE_DEPT,
		        		(SELECT CD_SUBJECT FROM EZ_DEPARTMENT WHERE CD_IDX = ri.RI_MANAGE_DEPT) RI_MANAGE_DEPT_TXT,
				        DECODE(RI_LOT_USE, 'OL', '온라인추첨', 'OO', '온라인 선착순', 'OF', '기타 접수') RI_LOT_USE,
				        DECODE(RI_CONFIRM_YN, 'Y', '승인', 'N', '미승인') RI_CONFIRM_YN,
				        CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               		 WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
			                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
					          ELSE '예약완료' END RI_PROGRESS,
		            	RI_SDATE,
		            	RI_EDATE,
				        RI_RESERVATION_SDATE,
				        RI_RESERVATION_EDATE,
				        RI_IMAGE_FILE_ID,
				        RI_READ_CNT,
				        RI_PLACE,
                        RI_RECRUIT_YN,
                        RI_RECRUIT_CNT,
                        RI_RESERVATION_SDATE||' '||LPAD(RI_RESERVATION_SDATE_HH, 2, '0')||':'||LPAD(RI_RESERVATION_SDATE_MM, 2, '0') RI_RESERVATION_SDT,
                        RI_RESERVATION_EDATE||' '||LPAD(RI_RESERVATION_EDATE_HH, 2, '0')||':'||LPAD(RI_RESERVATION_EDATE_MM, 2, '0') RI_RESERVATION_EDT,                                            
                        (select STRE_FILE_NM from COMTNFILEDETAIL where ATCH_FILE_ID = ri.RI_IMAGE_FILE_ID) as RI_MAIN_FILE_NM,
                        RI_OFF_LOT_USE,
                        RI_PO_YN
					FROM EZ_RESERVATION_INDEX ri
					WHERE USE_YN = 'Y'
					AND RI_TYPE = #{riType}
		]]>
		<include refid="searchReservationFac"/>
		<if test="searchOrg != null and searchOrg != ''">
		<![CDATA[ 	
				AND RI_SUPERVISION_ORG = #{searchOrg}				
		]]>
		</if>
		<if test="sort != null and sort != ''">
			<if test="sort == &quot;R&quot;">
				<![CDATA[ ORDER BY REG_DT DESC]]>
			</if>
			<if test="sort == &quot;V&quot;">
				<![CDATA[ ORDER BY RI_READ_CNT DESC]]>
			</if>
		</if>
		<if test="sort == null or sort == ''">
		<![CDATA[ ORDER BY REG_DT DESC ]]>
		</if>
		<![CDATA[ 
				) A WHERE ROWNUM <= #{lastIndex}
			) WHERE RN > #{firstIndex}
		]]>
	</select>
	
	<select id="selectPagFacTeam" parameterType="ReservationFacTeamVo" resultType="egovMap">
		<![CDATA[ 
			SELECT * FROM (
				SELECT /*+ FIRST_ROWS */ A.*, ROWNUM RN FROM (
					SELECT IDX,
					TEAM_NAME,
					USER_NM,
					USER_ID,
					USER_HP,
					USER_ETC,
					TO_CHAR(REG_DATE,'YYYYMMDD') REG_DATE
					FROM TB_PLAYGROUND_TEAM
					WHERE 1=1
		]]>
					<if test="searchKeyword != null and searchKeyword != ''">
						<if test="searchCondition == &quot;userNm&quot;">AND
							<![CDATA[ 
								USER_NM LIKE '%'||#{searchKeyword}||'%'
							]]>
						</if>
						<if test="searchCondition == &quot;userId&quot;">AND
							<![CDATA[ 
								USER_ID LIKE '%'||#{searchKeyword}||'%'
							]]>
						</if>
						<if test="searchCondition == &quot;teamName&quot;">AND
							<![CDATA[ 
								TEAM_NAME LIKE '%'||#{searchKeyword}||'%'
							]]>
						</if>
					</if>
		<![CDATA[ 
					ORDER BY IDX DESC
		
				) A WHERE ROWNUM <= #{lastIndex}
			) WHERE RN > #{firstIndex}
		]]>
	</select>
	
	<select id="selectFacTeam" parameterType="ReservationFacTeamVo" resultType="egovMap">
			<![CDATA[ 		
				SELECT IDX,
				TEAM_NAME,
				USER_NM,
				USER_ID,
				USER_HP,
				USER_ETC,
				TO_CHAR(REG_DATE,'YYYYMMDD') REG_DATE
				FROM TB_PLAYGROUND_TEAM
				WHERE IDX = #{ttIdx}
			]]>
	</select>
	
	<select id="selectPagFacTeamCnt" parameterType="ReservationFacTeamVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM TB_PLAYGROUND_TEAM
			WHERE 1=1			
		]]>
			<if test="searchKeyword != null and searchKeyword != ''">
				<if test="searchCondition == &quot;userNm&quot;">
					<![CDATA[ 
						AND USER_NM LIKE '%'||#{searchKeyword}||'%'
					]]>
				</if>
				<if test="searchCondition == &quot;userId&quot;">
					<![CDATA[ 
						AND USER_ID LIKE '%'||#{searchKeyword}||'%'
					]]>
				</if>
				<if test="searchCondition == &quot;teamName&quot;">
					<![CDATA[ 
						AND TEAM_NAME LIKE '%'||#{searchKeyword}||'%'
					]]>
				</if>
			</if>
	</select>
	
	<select id="selectReservationFacCnt" parameterType="ReservationIndexVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM EZ_RESERVATION_INDEX
			WHERE USE_YN = 'Y'
			AND RI_TYPE = #{riType}
		]]>
		<include refid="searchReservationFac"/>
	</select>
	
	<select id="selectPagArtReservationFac" parameterType="ReservationIndexVo" resultMap="ReservationFacMap">
		<![CDATA[ 
			SELECT * FROM (
				SELECT /*+ FIRST_ROWS */ A.*, ROWNUM RN FROM (
					SELECT
						RI_IDX,
				        RI_TITLE,
				        RI_SUPERVISION_ORG,
				        RI_SUPERVISION_ORG_NAME,
				        RI_MANAGE_DEPT,
		        		(SELECT CD_SUBJECT FROM EZ_DEPARTMENT WHERE CD_IDX = ri.RI_MANAGE_DEPT) RI_MANAGE_DEPT_TXT,
				        DECODE(RI_LOT_USE, 'OL', '온라인추첨', 'OO', '온라인 선착순', 'OF', '기타 접수') RI_LOT_USE,
				        DECODE(RI_CONFIRM_YN, 'Y', '승인', 'N', '미승인') RI_CONFIRM_YN,
				        CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               		 WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
			                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
					          ELSE '예약완료' END RI_PROGRESS,
		            	RI_SDATE,
		            	RI_EDATE,
				        RI_RESERVATION_SDATE,
				        RI_RESERVATION_EDATE,
				        RI_IMAGE_FILE_ID,
				        RI_READ_CNT,
				        RI_PLACE,
                        RI_RECRUIT_YN,
                        RI_RECRUIT_CNT,
                        RI_RESERVATION_SDATE||' '||LPAD(RI_RESERVATION_SDATE_HH, 2, '0')||':'||LPAD(RI_RESERVATION_SDATE_MM, 2, '0') RI_RESERVATION_SDT,
                        RI_RESERVATION_EDATE||' '||LPAD(RI_RESERVATION_EDATE_HH, 2, '0')||':'||LPAD(RI_RESERVATION_EDATE_MM, 2, '0') RI_RESERVATION_EDT,                                            
                        (select STRE_FILE_NM from COMTNFILEDETAIL where ATCH_FILE_ID = ri.RI_IMAGE_FILE_ID) as RI_MAIN_FILE_NM,
                        RI_OFF_LOT_USE,
                        RI_PO_YN
					FROM EZ_RESERVATION_INDEX ri
					WHERE USE_YN = 'Y'
					AND RI_TYPE = #{riType}
					AND RI_SUPERVISION_ORG = 'art'
		]]>
		<include refid="searchReservationFac"/>
		<if test="searchOrg != null and searchOrg != ''">
			<![CDATA[ 
				AND RI_SUPERVISION_ORG = #{searchOrg}	
			]]>
		</if>
		<if test="sort != null and sort != ''">
			<if test="sort == &quot;R&quot;">
				<![CDATA[ ORDER BY REG_DT DESC ]]>
			</if>
			<if test="sort == &quot;V&quot;">
				<![CDATA[ ORDER BY RI_READ_CNT DESC ]]>
			</if>
		</if>
		<if test="sort == null or sort == ''">
		<![CDATA[ ORDER BY REG_DT DESC ]]>
		</if>
		<![CDATA[ 
				) A WHERE ROWNUM <= #{lastIndex}
			) WHERE RN > #{firstIndex}
		]]>
	</select>
	
	<select id="selectArtReservationFacCnt" parameterType="ReservationIndexVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM EZ_RESERVATION_INDEX
			WHERE USE_YN = 'Y'
			AND RI_TYPE = #{riType}
			AND RI_SUPERVISION_ORG = 'art'
		]]>
		<include refid="searchReservationFac"/>
	</select>

	

	<select id="selectListReservationFac" parameterType="ReservationIndexVo" resultMap="ReservationFacMap">
		<![CDATA[ 
			SELECT *
			FROM EZ_RESERVATION_INDEX
			WHERE USE_YN = 'Y'
		]]>
		<include refid="searchReservationFac"/>
		<![CDATA[ 
			ORDER BY REG_DT DESC
		]]>
	</select>

	<select id="selectListReservationFacAddItem" parameterType="ReservationIndexVo" resultMap="ReservationFacAddItemMap">
		<![CDATA[ 
			SELECT
				RI_IDX,
				RA_IDX,
				RA_TITLE,
				RA_CONTENT
			FROM RESERVATION_ADD_ITEM
			WHERE RI_IDX = #{riIdx}
			ORDER BY RA_IDX ASC
		]>
	</select>
	<select id="selectListReservationFacItem" parameterType="ReservationIndexVo" resultMap="ReservationFacItemMap">
		<![CDATA[ 
			SELECT
			   RT.RI_IDX,
		       RT.RT_IDX,
		       RT.RT_ITEM_TYPE,
		       RT.RT_ITEM_TITLE,
		       RT.RT_ITEM_EXAMPLE,
		       RT.RT_ITEM_EXAMPLE_LEN,
		       RT.RT_ITEM_NOTICE,
		       RT.RT_ITEM_USE_CHECK,
		       RT.RT_ITEM_ETC_USE_CHECK,
		       RA.RA_ANSWER as RT_ANSWER,
		       RA.RA_ETC_ANSWER AS RT_ETC_ANSWER
			FROM RESERVATION_ITEM RT
			LEFT OUTER JOIN RESERVATION_USER_ANSWER RA ON RT.RI_IDX = RA.RI_IDX AND RT.RT_IDX = RA.RT_IDX AND RA.RU_IDX = #{ruIdx}
			WHERE RT.RI_IDX = #{riIdx}
			ORDER BY RT.RT_IDX ASC
		]]>
	</select>

	<delete id="deleteReservationFacAddItem" parameterType="ReservationIndexVo">
		<![CDATA[ 
			DELETE FROM RESERVATION_ADD_ITEM
			WHERE RI_IDX = #{riIdx}
		]]>
	</delete>

	<delete id="deleteReservationFacItem" parameterType="ReservationIndexVo">
		<![CDATA[ 
			DELETE FROM RESERVATION_ITEM
			WHERE RI_IDX = #{riIdx}
		]]>
	</delete>

	<select id="selectListReservationFacUserInfo" parameterType="ReservationFacVo" resultMap="ReservationFacUserInfoMap">
		<![CDATA[ 
			SELECT
			    RU_IDX,
		        RI_IDX,
		        RU_NAME,
		        RU_DUPKEY,
		        RU_ZIPCODE,
		        RU_ADDRESS,
		        RU_ADDRESS_DTL,
		        RU_TEL,
		        RU_HP,
		        RU_EMAIL,
		        RU_LOT_RESULT,
		        RU_USERLOGIN_TYPE,
		        RU_IP,
		        RU_RESERVATION_NAME,
		        RA_IDX,
		       RU_RESERVATION_DAY,
		       RTM_IDX,
		       PAY_STATUS,
		       PAY_PRICE,
		       ORDNO,
		       PAY_TID,
		       PAY_AUTH,
		       METHOD,
		       PAY_MEMO
			FROM RESERVATION_USER_INFO
			WHERE RU_DEL_YN = 'N'
			AND RI_IDX = #{riIdx}
			AND RU_RESERVATION_DAY = #{ruReservationDay}
			AND RA_IDX = #{raIdx}
		]]>	
			<if test="rtmIdx != null and rtmIdx != ''">
			<![CDATA[ 
				AND INSTR(RTM_IDX,#{rtmIdx}) > 0
			]]>
			</if>
			
		
	</select>
	
	<select id="selectListReservationFacUserInfoReturnFee" parameterType="ReservationFacVo" resultMap="ReservationFacUserInfoMap">
		<![CDATA[ 
			SELECT
			    RU_IDX,
		        RI_IDX,
		        RU_NAME,
		        RU_DUPKEY,
		        RU_ZIPCODE,
		        RU_ADDRESS,
		        RU_ADDRESS_DTL,
		        RU_TEL,
		        RU_HP,
		        RU_EMAIL,
		        RU_LOT_RESULT,
		        RU_USERLOGIN_TYPE,
		        RU_IP,
		        RU_RESERVATION_NAME,
		        RA_IDX,
		       RU_RESERVATION_DAY,
		       RTM_IDX,
		       PAY_STATUS,
		       PAY_PRICE,
		       ORDNO,
		       PAY_TID,
		       PAY_AUTH,
		       METHOD,
		       PAY_MEMO
			FROM RESERVATION_USER_INFO
			WHERE RU_DEL_YN = 'Y'
			AND RI_IDX = #{riIdx}
			AND RU_RESERVATION_DAY = #{ruReservationDay}
			AND RA_IDX = #{raIdx}
			AND PAY_STATUS in('3','5')
		]]>	
			<if test="rtmIdx != null and rtmIdx != ''">
			<![CDATA[ 
				AND INSTR(RTM_IDX,#{rtmIdx}) > 0
			]]>
			</if>
			
		
	</select>

	<select id="selectReservationFacUserInfo" parameterType="ReservationUserInfoVo" resultMap="ReservationFacUserInfoMap">
		<![CDATA[ 
			SELECT RU_IDX,
		       RI_IDX,
		       RU_NAME,
		       RU_DUPKEY,
		       RU_ZIPCODE,
		       RU_ADDRESS,
		       RU_ADDRESS_DTL,
		       RU_TEL,
		       RU_HP,
		       RU_EMAIL,
		       RU_LOT_RESULT,
		       RU_USERLOGIN_TYPE,
		       RU_IP,
		       RU_RESERVATION_NAME,
		       RA_IDX,
		       RU_RESERVATION_DAY,
		       RTM_IDX,
		       PAY_STATUS,
		       PAY_PRICE,
		       ORDNO,
		       PAY_TID,
		       PAY_AUTH,
		       METHOD,
		       PAY_MEMO
		  FROM RESERVATION_USER_INFO
		  WHERE RU_DEL_YN = 'N'
		  AND RI_IDX = #{riIdx}
		  AND RU_IDX = #{ruIdx}
		]]>
	</select>
	
	<select id="selectReservationFacUserInfoReturnFee" parameterType="ReservationUserInfoVo" resultMap="ReservationFacUserInfoMap">
		<![CDATA[ 
			SELECT RU_IDX,
		       RI_IDX,
		       RU_NAME,
		       RU_DUPKEY,
		       RU_ZIPCODE,
		       RU_ADDRESS,
		       RU_ADDRESS_DTL,
		       RU_TEL,
		       RU_HP,
		       RU_EMAIL,
		       RU_LOT_RESULT,
		       RU_USERLOGIN_TYPE,
		       RU_IP,
		       RU_RESERVATION_NAME,
		       RA_IDX,
		       RU_RESERVATION_DAY,
		       RTM_IDX,
		       PAY_STATUS,
		       PAY_PRICE,
		       ORDNO,
		       PAY_TID,
		       PAY_AUTH,
		       METHOD,
		       PAY_MEMO
		  FROM RESERVATION_USER_INFO
		  WHERE RU_DEL_YN = 'Y'
		  AND RI_IDX = #{riIdx}
		  AND RU_IDX = #{ruIdx}
		]]>
	</select>

	<insert id="insertReservationFacUserInfo" parameterType="ReservationUserInfoVo">
		<![CDATA[ 
			INSERT INTO RESERVATION_USER_INFO
			(
			    RU_IDX,
	            RI_IDX,
	            RA_IDX,
	            RU_NAME,
	            RU_DUPKEY,
	            RU_ZIPCODE,
	            RU_ADDRESS,
	            RU_ADDRESS_DTL,
	            RU_TEL,
	            RU_HP,
	            RU_EMAIL,
	            RU_RESERVATION_NAME,
	            RU_RESERVATION_DAY,
	            RU_LOT_RESULT,
	            RU_USERLOGIN_TYPE,
	            RU_IP,
	            RU_DEL_YN,
	            REG_ID,
	            REG_DT,
	            RTM_IDX,
	            RTM_WEEK,
	            PAY_STATUS,
	            PAY_PRICE,
	            ORDNO
			)
			VALUES
			(
				#{ruIdx},
	            #{riIdx},
	            #{raIdx},
	            #{ruName},
	            #{ruDupkey},
	            #{ruZipcode},
	            #{ruAddress},
	            #{ruAddressDtl},
	            #{ruTel},
	            #{ruHp},
	            #{ruEmail},
	            #{ruReservationName},
	            #{ruReservationDay},
	            #{ruLotResult},
	            #{ruUserloginType},
	            #{ruIp},
	            'N',
	            #{regId},
	            sysdate,
	            #{rtmIdx},
	            #{rtmWeek},
	            #{payStatus},
	            #{payPrice},
	            #{ordno}
			)
		]]>
	</insert>

	<insert id="insertReservationFacUserAnswer" parameterType="ReservationUserAnswerVo">
		<![CDATA[ 
			INSERT INTO RESERVATION_USER_ANSWER
			(
			    RI_IDX,
	            RU_IDX,
	            RT_IDX,
	            RA_ITEM_TYPE,
	            RA_ANSWER,
	            RA_ETC_ANSWER
			)
			VALUES
			(
				#{riIdx},
	            #{ruIdx},
	            #{rtIdx},
	            #{raItemType},
	            #{raAnswer},
	            #{raEtcAnswer}
			)
		]]>
	</insert>

	<update id="updateReservationFacUserInfo" parameterType="ReservationUserInfoVo">
		<![CDATA[ 
			UPDATE RESERVATION_USER_INFO
			SET
				RU_NAME = #{ruName},
	            RU_DUPKEY = #{ruDupkey},
	            RU_ZIPCODE = #{ruZipcode},
	            RU_ADDRESS = #{ruAddress},
	            RU_ADDRESS_DTL = #{ruAddressDtl},
	            RU_TEL = #{ruTel},
	            RU_HP = #{ruHp},
	            RU_EMAIL = #{ruEmail},
	            RU_RESERVATION_NAME = #{ruReservationName},
	            RU_USERLOGIN_TYPE = #{ruUserloginType},
	            RU_IP = #{ruIp},
	     ]]>    
	            <if test="payStatus != null and payStatus != ''">
				PAY_STATUS = #{payStatus},				
				<!-- PAY_PRICE = #{payPrice}, -->
				PAY_MEMO = #{payMemo},
				METHOD = #{method},
				</if>
		<![CDATA[ 		
				MOD_DT = SYSDATE,
				MOD_ID = #{modId}
			WHERE RI_IDX = #{riIdx}
			AND RU_IDX = #{ruIdx}
		]]>
	</update>

	<delete id="deleteReservationFacUserAnswer" parameterType="ReservationUserInfoVo">
		<![CDATA[ 
			DELETE FROM RESERVATION_USER_ANSWER
			WHERE RI_IDX = #{riIdx}
			AND RU_IDX = #{ruIdx}
		]]>
	</delete>

	<update id="updateReservationFacRuLotResult" parameterType="ReservationIndexVo">
		<![CDATA[ 
			UPDATE RESERVATION_USER_INFO
			SET
				RU_LOT_RESULT = 'S',
				MOD_DT = SYSDATE,
				MOD_ID = #{modId}
			WHERE RU_IDX = #{ruIdx}
        ]]> 
	</update>

	<update id="deleteReservationFacUserInfo" parameterType="ReservationUserInfoVo">
		<![CDATA[ 
			UPDATE RESERVATION_USER_INFO
			SET
				RU_DEL_YN = 'Y',
				MOD_DT = SYSDATE,
				MOD_ID = #{modId}
			WHERE RI_IDX = #{riIdx}
			AND RU_IDX = #{ruIdx}
		]]>
	</update>
	
	<update id="updateReservationFacUserConfirm" parameterType="ReservationUserInfoVo">
		<![CDATA[ 
			UPDATE RESERVATION_USER_INFO
			SET
				RU_LOT_RESULT = 'S',
				MOD_DT = SYSDATE,
				MOD_ID = #{modId}
			WHERE RI_IDX = #{riIdx}
			AND RU_IDX = #{ruIdx}
		]]>
	</update>

	<select id="selectReservationFacConfirmCnt" parameterType="ReservationFacVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM RESERVATION_USER_INFO
			WHERE RI_IDX = #{riIdx}
			AND RA_IDX = #{raIdx}
			AND RU_RESERVATION_DAY = #{ruReservationDay}
			AND RU_LOT_RESULT = 'S'
       		AND RU_DEL_YN = 'N'
		]]>
	</select>

	<select id="selectListReservationFacFix" parameterType="ReservationFacVo" resultType="egovMap">
		<![CDATA[ 
		SELECT RAI.RI_IDX,
		       RAI.RA_IDX,
		       RAI.RA_CONTENT,
		       RUI.RU_RESERVATION_DAY,
		       CASE
		           WHEN RUI.RU_RESERVATION_NAME IS NULL
		               AND RUI.RU_NAME IS NOT NULL
		           THEN SUBSTR(RUI.RU_NAME, 0, 1) || '**'
		           ELSE RUI.RU_RESERVATION_NAME
		       END RU_RESERVATION_NAME
		  FROM RESERVATION_ADD_ITEM RAI
		   LEFT OUTER JOIN RESERVATION_USER_INFO RUI
		       ON RAI.RI_IDX = RUI.RI_IDX
		       AND RAI.RA_IDX = RUI.RA_IDX
		       AND RUI.RU_LOT_RESULT = 'S'
		       AND RUI.RU_DEL_YN = 'N'
		       AND RUI.RU_RESERVATION_DAY = #{ruReservationDay}
		 WHERE RAI.RI_IDX = #{riIdx}
		       AND RAI.RA_CONTENT IS NOT NULL
		ORDER BY RAI.RA_IDX ASC
		]]>
	</select>

	<select id="selectReservationFacUserInfoDupCnt" parameterType="ReservationUserInfoVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM RESERVATION_USER_INFO
			WHERE RI_IDX = #{riIdx}
			AND RU_RESERVATION_DAY = #{ruReservationDay}
			AND RA_IDX = #{raIdx}
 			AND RU_DUPKEY = #{ruDupkey}
 			AND RU_DEL_YN = 'N'
		]]>
	</select>

	<sql id="searchReservationMyFac">
		<if test="searchKeyword != null and searchKeyword != ''">
			<if test="searchCondition == &quot;title&quot;">
				<![CDATA[ 
					AND RI.RI_TITLE LIKE '%'||#{searchKeyword}||'%'
				]]>
			</if>
			<if test="searchCondition == &quot;org&quot;">
				<![CDATA[ 
					AND RI.RI_SUPERVISION_ORG = #{searchKeyword}
				]]>
			</if>
			<if test="searchCondition == &quot;all&quot;">
				<![CDATA[ 
					AND (RI.RI_TITLE LIKE '%'||#{searchKeyword}||'%' OR RI.RI_SUPERVISION_ORG = #{searchKeyword})
				]]>
			</if>
		</if>
	</sql>

	<select id="selectPagReservationMyFac" parameterType="ReservationIndexVo" resultMap="ReservationMyFacMap">
		<![CDATA[ 
			SELECT * FROM (
				SELECT /*+ FIRST_ROWS */ A.*, ROWNUM RN FROM (
					SELECT RI.RI_IDX, RU.RU_IDX, 
						   RI.RI_TITLE, 
						   DEPT.CD_SUBJECT RI_MANAGE_DEPT_TXT,
						   RU.RU_RESERVATION_DAY, 
						   ITEM.RA_CONTENT,
					       CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
					               WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
			                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
					          ELSE '예약완료' END RI_PROGRESS,
					       CASE WHEN (SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = RI.RI_IDX AND RU_DUPKEY <> #{ruDupkey} AND RU_RESERVATION_DAY = RU.RU_RESERVATION_DAY AND RU_LOT_RESULT = 'S' AND RU_DEL_YN = 'N') > 0 THEN '탈락'
					       		WHEN RU_DEL_YN = 'Y' THEN '취소'
					            WHEN RU_LOT_RESULT = 'R' THEN '접수'
					            WHEN RU_LOT_RESULT = 'S' THEN '확정'
					            END RU_LOT_RESULT
					  FROM EZ_RESERVATION_INDEX RI
					  INNER JOIN RESERVATION_USER_INFO RU ON RI.RI_IDX = RU.RI_IDX AND RU_DUPKEY = #{ruDupkey}
					  INNER JOIN RESERVATION_ADD_ITEM ITEM ON ITEM.RI_IDX = RI.RI_IDX AND ITEM.RA_IDX = RU.RA_IDX
					  INNER JOIN EZ_DEPARTMENT DEPT ON DEPT.CD_IDX = RI.RI_MANAGE_DEPT
					WHERE RI.RI_TYPE = 'F'
					AND RI.USE_YN = 'Y'
		]]>
		<include refid="searchReservationMyFac"/>
		<![CDATA[ 
					ORDER BY RU.REG_DT DESC
				) A WHERE ROWNUM <= #{lastIndex}
			) WHERE RN > #{firstIndex}
		]]>
	</select>

	<select id="selectReservationMyFacCnt" parameterType="ReservationIndexVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*)
			FROM EZ_RESERVATION_INDEX RI
			  INNER JOIN RESERVATION_USER_INFO RU ON RI.RI_IDX = RU.RI_IDX AND RU_DUPKEY = #{ruDupkey}
			  INNER JOIN RESERVATION_ADD_ITEM ITEM ON ITEM.RI_IDX = RI.RI_IDX AND ITEM.RA_IDX = RU.RA_IDX
			  INNER JOIN EZ_DEPARTMENT DEPT ON DEPT.CD_IDX = RI.RI_MANAGE_DEPT
			WHERE RI.RI_TYPE = 'F'
			AND RI.USE_YN = 'Y'
		]]>
		<include refid="searchReservationMyFac"/>
	</select>
	
	<select id="selectReservationMyFac" parameterType="ReservationIndexVo" resultMap="ReservationFacViewMap">
		<![CDATA[ 
			SELECT
				ri.RI_IDX,
		        ri.RI_TYPE,
		        ri.RI_TITLE,
		        ri.RI_SUPERVISION_ORG,
		        RI_SUPERVISION_ORG_NAME,
		        ri.RI_MANAGE_DEPT,
		        (SELECT CD_SUBJECT FROM EZ_DEPARTMENT WHERE CD_IDX = ri.RI_MANAGE_DEPT) RI_MANAGE_DEPT_TXT,
		        CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
		          ELSE '예약완료' END RI_PROGRESS,
		        ri.RI_TEL1,
		        ri.RI_TEL2,
		        ri.RI_TEL3,
		        ri.RI_PLACE,
		        ri.RI_PAY,
		        ri.RI_GUIDE,
		        ri.RI_DAY_WEEK,
		        ri.RI_LOT_USE,
		        ri.RI_OFF_LOT_USE,
		        ri.RI_SDATE,
		        ri.RI_EDATE,
		        ri.RI_SITE_URL,
		        ri.RI_USERLOGIN_TYPE,
		        ri.RI_RECRUIT_CNT,
		        ri.RI_RECRUIT_MAX_CNT,
		        ri.RI_RESERVATION_SDATE,
		        ri.RI_RESERVATION_SDATE_HH,
		        ri.RI_RESERVATION_SDATE_MM,
		        ri.RI_RESERVATION_EDATE,
		        ri.RI_RESERVATION_EDATE_HH,
		        ri.RI_RESERVATION_EDATE_MM,
		        ri.RI_CONFIRM_SDATE,
		        ri.RI_CONFIRM_SDATE_HH,
		        ri.RI_CONFIRM_SDATE_MM,
		        ri.RI_CONFIRM_EDATE,
		        ri.RI_CONFIRM_EDATE_HH,
		        ri.RI_CONFIRM_EDATE_MM,
		        ri.RI_AFTER_REGSTER_YN,
		        ri.RI_CONFIRM_YN,
		        ri.RI_HAVE_FAC,
		        ri.RI_IMAGE_FILE_ID,
		        ri.REG_ID,
		        ri.REG_DT,
		        (SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = ri.RI_IDX AND RU_DEL_YN = 'N')	RI_ACC_CNT,
		        ru.RU_LOT_RESULT,
                ru.RU_IDX,
                ru.RU_DEL_YN USE_YN,       
                ri.RI_RESERVATION_MIN_TIME,
                ri.RI_RESERVATION_MAX_TIME,
                ri.RI_PO_YN,
                ri.RI_FEE_GUBUN,               
                (select STRE_FILE_NM from COMTNFILEDETAIL where ATCH_FILE_ID = ri.RI_IMAGE_FILE_ID) as RI_MAIN_FILE_NM,
                 ri.RI_PAY_YN,
                ri.RI_ONLINE_PAY_YN,
                ru.PAY_STATUS,
                ri.PGKEY
			FROM EZ_RESERVATION_INDEX ri
			LEFT OUTER JOIN RESERVATION_USER_INFO ru ON ri.RI_IDX = ru.RI_IDX AND ru.RU_DUPKEY = #{ruDupkey}
			WHERE ri.USE_YN = 'Y'
			AND ru.RU_IDX = #{ruIdx}
		]]>
	</select>
	
	<select id="selectReservationFacView" parameterType="ReservationIndexVo" resultMap="ReservationFacViewMap2">
		<![CDATA[ 
			SELECT
				ri.RI_IDX,
		        ri.RI_TYPE,
		        ri.RI_TITLE,
		        ri.RI_SUPERVISION_ORG,
		        RI_SUPERVISION_ORG_NAME,
		        ri.RI_MANAGE_DEPT,
		        (SELECT CD_SUBJECT FROM EZ_DEPARTMENT WHERE CD_IDX = ri.RI_MANAGE_DEPT) RI_MANAGE_DEPT_TXT,
		        CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
		          ELSE '예약완료' END RI_PROGRESS,
		        ri.RI_TEL1,
		        ri.RI_TEL2,
		        ri.RI_TEL3,
		        ri.RI_PLACE,
		        ri.RI_PAY,
		        ri.RI_GUIDE,
		        ri.RI_DAY_WEEK,
		        ri.RI_LOT_USE,
		        ri.RI_OFF_LOT_USE,
		        ri.RI_SDATE,
		        ri.RI_EDATE,
		        ri.RI_SITE_URL,
		        ri.RI_USERLOGIN_TYPE,
		        ri.RI_RECRUIT_CNT,
		        ri.RI_RECRUIT_MAX_CNT,
		        ri.RI_RESERVATION_SDATE,
		        ri.RI_RESERVATION_SDATE_HH,
		        ri.RI_RESERVATION_SDATE_MM,
		        ri.RI_RESERVATION_EDATE,
		        ri.RI_RESERVATION_EDATE_HH,
		        ri.RI_RESERVATION_EDATE_MM,
		        ri.RI_CONFIRM_SDATE,
		        ri.RI_CONFIRM_SDATE_HH,
		        ri.RI_CONFIRM_SDATE_MM,
		        ri.RI_CONFIRM_EDATE,
		        ri.RI_CONFIRM_EDATE_HH,
		        ri.RI_CONFIRM_EDATE_MM,
		        ri.RI_AFTER_REGSTER_YN,
		        ri.RI_CONFIRM_YN,
		        ri.RI_HAVE_FAC,
		        ri.RI_IMAGE_FILE_ID,
		        ri.REG_ID,
		        ri.REG_DT,
		        (SELECT COUNT(*) FROM RESERVATION_USER_INFO WHERE RI_IDX = ri.RI_IDX AND RU_DEL_YN = 'N')	RI_ACC_CNT,
		        (select STRE_FILE_NM from COMTNFILEDETAIL where ATCH_FILE_ID = ri.RI_IMAGE_FILE_ID) as RI_MAIN_FILE_NM,
		        ri.RI_PAY_YN,
                ri.RI_ONLINE_PAY_YN,
                ri.RI_FEE_GUBUN,
                ri.PGKEY                
			FROM EZ_RESERVATION_INDEX ri
			WHERE ri.USE_YN = 'Y'
			AND ri.RI_IDX = #{riIdx}
		]]>
	</select>
	
	<select id="selectItemCountList" parameterType="ReservationUserInfoVo" resultType="egovMap">
		<![CDATA[ 
			SELECT count(RA_IDX) AS RA_CNT, RA_CONTENT FROM
			(
			select ru.RA_IDX, ra.RA_CONTENT
			FROM EZ_RESERVATION_INDEX ri LEFT OUTER JOIN RESERVATION_USER_INFO ru ON ri.RI_IDX = ru.RI_IDX LEFT OUTER JOIN RESERVATION_ADD_ITEM ra ON ri.RI_IDX = ra.RI_IDX
			WHERE ri.USE_YN = 'Y'
			  AND RU_DEL_YN = 'N'
			  AND ru.RA_IDX = ra.RA_IDX
			  AND RU_RESERVATION_DAY = #{ruReservationDay}
			  AND ri.RI_IDX = #{riIdx}
			)A group by A.RA_IDX, RA_CONTENT
		]]>
	</select>

	<!-- 관리부서 목록(관,과,동,보건소 목록)  -->
	<select id="selectDeptCode" resultType="egovMap">
	<![CDATA[ 
		SELECT
			CD_IDX, 
			CD_SUBJECT 
		FROM EZ_DEPARTMENT
		WHERE (CD_SUBJECT LIKE '%과' OR CD_SUBJECT LIKE '%관' OR CD_SUBJECT LIKE '%동' OR CD_SUBJECT LIKE '%건소')
		AND CD_USE = 'Y'
        ORDER BY CD_CODE
    ]]>
	</select>
	
	<select id="selectReservationTimeInfo" parameterType="ReservationIndexVo" resultMap="ReservationFacTimeMap">
		<![CDATA[ 
			select rtm_week,st_time,ed_time,rtm_type,rtm_term 
			from (select rtm_week,min(st_time)st_time,max(ed_time)ed_time,rtm_type,rtm_term from reservation_time 
			where ri_idx = #{riIdx} 
			and rtm_type = 'D'
			group by rtm_week,rtm_type,rtm_term
			union all 
			select rtm_week,st_time,ed_time,rtm_type,rtm_term from reservation_time
			where ri_idx = #{riIdx}
			and rtm_type='T') a
			where 1=1
			order by rtm_week,st_time		
		]]>
	</select>
	
	<delete id="deleteReservationFacTime" parameterType="ReservationIndexVo">
		<![CDATA[ 
			DELETE FROM RESERVATION_TIME
			WHERE RI_IDX = #{riIdx}
		]]>
	</delete>
	
	<select id="selectReservationUserTimeInfo" parameterType="ReservationFacVo" resultMap="ReservationFacUserTimeMap">
		<![CDATA[ 
			select rtm_week,st_time,ed_time,rtm_type,rtm_term,rtm_idx
            from reservation_time
            where ri_idx = #{riIdx}
            and rtm_week = #{timeweek}	
            order by rtm_idx	
		]]>
	</select>
	
	<select id="selectReservationUserTimeInfo2" parameterType="ReservationFacVo" resultMap="ReservationFacUserTimeMap2">
		<![CDATA[ 
			select a.rtm_week,st_time,ed_time,rtm_type,rtm_term,a.rtm_idx,b.ru_reservation_day
			from reservation_time a,(select rtm_idx,rtm_week,ru_reservation_day from reservation_user_info where ru_reservation_day = #{ruReservationDay} and ri_idx = #{riIdx} and rtm_week = #{timeweek} and ru_del_yn = 'N' )b
			where 
			INSTR( b.rtm_idx(+), a.rtm_idx) > 0
			and a.ri_idx = #{riIdx}
			and a.rtm_week = #{timeweek}
			order by rtm_idx		
		]]>
	</select>
	
	<select id="selectReservationUserTimeInfo3" parameterType="ReservationUserInfoVo" resultMap="ReservationFacUserTimeMap2">
		<![CDATA[ 
			select a.rtm_week,st_time,ed_time,rtm_type,rtm_term,a.rtm_idx,b.ru_reservation_day
			from reservation_time a,reservation_user_info b
			where 
			INSTR( b.rtm_idx(+), a.rtm_idx) > 0
			and a.ri_idx = b.ri_idx
			and a.rtm_week = b.RTM_WEEK
			and b.ru_idx = #{ruIdx}
			order by rtm_idx		
		]]>
	</select>
	
	<select id="selectReservationUserTimeInfo4" parameterType="ReservationUserInfoVo" resultMap="ReservationFacUserTimeMap2">
		<![CDATA[ 
			select a.rtm_week,st_time,ed_time,rtm_type,rtm_term,a.rtm_idx,b.ru_reservation_day
			from reservation_time a,(select rtm_idx,rtm_week,ru_reservation_day from reservation_user_info where ru_idx= #{ruIdx} )b
			where 
			INSTR( b.rtm_idx, a.rtm_idx) > 0
			and a.ri_idx = #{riIdx}
			and a.rtm_week = b.rtm_week
			order by rtm_idx	
		]]>
	</select>
	
	<select id="selectReservationFacAnotherFac" resultMap="ReservationFacAnotherMap">
		<![CDATA[ 
		SELECT RI_IDX,RI_TITLE,RI_PROGRESS FROM (
                SELECT
                    RI_IDX,
                    RI_TITLE,
                    CASE WHEN RI_RESERVATION_SDATE IS NOT NULL AND RI_RESERVATION_SDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약대기'
		               WHEN RI_RESERVATION_SDATE <= TO_CHAR(SYSDATE, 'yyyy-mm-dd') AND TO_CHAR(SYSDATE, 'yyyy-mm-dd') <= RI_RESERVATION_EDATE THEN '예약중'
                 WHEN RI_RESERVATION_SDATE IS NULL AND RI_EDATE >= TO_CHAR(SYSDATE, 'yyyy-mm-dd') THEN '예약중'
		          ELSE '예약완료' END RI_PROGRESS                
                FROM EZ_RESERVATION_INDEX ri
                WHERE USE_YN = 'Y'
                AND RI_TYPE = 'F'
         AND RI_CONFIRM_YN = 'Y' 

        ORDER BY REG_DT DESC
        )WHERE RI_PROGRESS = '예약중'
	]]>
	</select>	
	
	<select id="selectUserckCnt" parameterType="ReservationFacTeamVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*) CNT
			FROM TB_PLAYGROUND_TEAM
			WHERE USER_ID = #{userId}
		]]>
	</select>
	
	<select id="selectTeamCkCnt" parameterType="ReservationFacTeamVo" resultType="java.lang.Integer">
		<![CDATA[ 
			SELECT COUNT(*) CNT
			FROM TB_PLAYGROUND_TEAM
			WHERE TEAM_NAME = #{teamName}
		]]>
	</select>	
	
	<insert id="insertReservationFacTeam" parameterType="ReservationFacTeamVo">
		<![CDATA[ 
			INSERT INTO TB_PLAYGROUND_TEAM
			(
			    IDX
	            , USER_ID
	            , USER_NM
	            , TEAM_NAME
	            , USER_HP
	            , USER_ETC
	            , REG_DATE
			)
			VALUES
			(
				(SELECT NVL(MAX(idx+1),1) from TB_PLAYGROUND_TEAM)
				,#{userId}
				,#{userNm}
				,#{teamName}
				,#{userHp}
				,#{userEtc}
				,sysdate
			)
		]]>
	</insert>
	
	<update id="updateReservationFacTeam" parameterType="ReservationFacTeamVo">
		<![CDATA[ 
			UPDATE TB_PLAYGROUND_TEAM
			SET
				USER_ID = #{userId}
				, USER_NM = #{userNm}
				, TEAM_NAME = #{teamName}
				, USER_HP = #{userHp}
				, USER_ETC = #{userEtc}				
			WHERE IDX = #{ttIdx}
		]]>
	</update>
</mapper>